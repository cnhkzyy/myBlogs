## 快速导航
+ [```校验项目名不能重复```](#校验项目名不能重复)
+ [```自定义校验器项目名必须包含项目```](#自定义校验器项目名必须包含项目)
+ [```单字段的校验```](#单字段的校验)
+ [```多字段的校验```](#多字段的校验)
+ [```校验顺序```](#校验顺序)


## 校验项目名不能重复

### 修改序列化器projects/serializer.py

```python
from rest_framework import serializers
from rest_framework.validators import UniqueValidator
from projects.models import Projects


#1.继承Serializer类或者子类
class ProjectSerializer(serializers.Serializer):
    '''
    创建项目序列化器类
    '''
    #1.序列化器中定义的类属性往往与模型类字段一一对应
    #2.label选项相当于verbose_name，help_text在后台显示，是一个别名
    #3.#定义的序列化器字段，默认既可以进行序列化输出，也可以进行反序列化输入
    #4.read_only=True，指定该字段只能进行序列化输出
    #5.write_only=True,指定该字段只进行反序列化输入，但不进行序列化输出
    #6.需要输出哪些字段，那么在序列化器中就定义哪些字段。不需要输入和输出的可以直接不定义
    id = serializers.IntegerField(label='ID', read_only=True)
    name = serializers.CharField(label='项目名称', max_length=200,
                                 help_text='项目名称111', write_only=True, validators = [UniqueValidator(queryset=Projects.objects.all(), message='项目名不能重复')])
    leader = serializers.CharField(label='负责人', max_length=50, help_text='负责人')
    tester = serializers.CharField(label='测试人员', max_length=50, help_text='测试人员')
    programer = serializers.CharField(label='开发人员', max_length=50, help_text='开发人员')
    publish_app = serializers.CharField(label='发布应用', max_length=50, help_text='发布应用')
    #allow_null相当于模型类中的null，allow_blank相当于模型类中的blank
    desc = serializers.CharField(label='简要描述', allow_null=True, allow_blank=True, help_text='简要描述', default='')
```

name已重复，在vscode中使用httpie发送请求：```http -v :8000/index/ < create_project.json```, 失败的提示是定义的message

![image-20210628212235267](http://becktuchuang.oss-cn-beijing.aliyuncs.com/img/image-20210628212235267.png)

## 自定义校验器项目名必须包含项目

```python
#创建自定义校验器
#第一个参数为字段的值
def is_unique_project_name(name):
    #要求项目的名字必须包含项目
    if '项目' not in name:
        raise serializers.ValidationError('项目名称中必须包含"项目"')
        
        
#1.继承Serializer类或者子类
class ProjectSerializer(serializers.Serializer):
    '''
    创建项目序列化器类
    '''
    #1.序列化器中定义的类属性往往与模型类字段一一对应
    #2.label选项相当于verbose_name，help_text在后台显示，是一个别名
    #3.#定义的序列化器字段，默认既可以进行序列化输出，也可以进行反序列化输入
    #4.read_only=True，指定该字段只能进行序列化输出
    #5.write_only=True,指定该字段只进行反序列化输入，但不进行序列化输出
    #6.需要输出哪些字段，那么在序列化器中就定义哪些字段。不需要输入和输出的可以直接不定义
    id = serializers.IntegerField(label='ID', read_only=True)
    name = serializers.CharField(label='项目名称', max_length=200,
                                 help_text='项目名称111', write_only=True,
                                 validators=[UniqueValidator(queryset=Projects.objects.all(), message='项目名不能重复'), is_unique_project_name])
    leader = serializers.CharField(label='负责人', max_length=50, help_text='负责人')
    tester = serializers.CharField(label='测试人员', max_length=50, help_text='测试人员')
    programer = serializers.CharField(label='开发人员', max_length=50, help_text='开发人员')
    publish_app = serializers.CharField(label='发布应用', max_length=50, help_text='发布应用')
    #allow_null相当于模型类中的null，allow_blank相当于模型类中的blank
    desc = serializers.CharField(label='简要描述', allow_null=True, allow_blank=True, help_text='简要描述
```

name不包含项目，在vscode中使用httpie发送请求：```http -v :8000/index/ < create_project.json```, 失败的提示为抛出的异常提示

![image-20210628213441609](http://becktuchuang.oss-cn-beijing.aliyuncs.com/img/image-20210628213441609.png)



## 单字段的校验

以validate_开头，能够自动识别，不需要添加到validators中

```python
#单字段的校验
    def validate_name(self, value):
        if not value.endswith('项目'):
            raise serializers.ValidationError('项目名称必须以"项目"结尾')
        #校验成功之后，一定要返回value
        return value
```

name部署以项目结尾

![image-20210628214935766](http://becktuchuang.oss-cn-beijing.aliyuncs.com/img/image-20210628214935766.png)



## 多字段的校验

```python
    def validate(self, attrs):
        '''
        多字段联合检验
        :param attrs:
        :return:
        '''
        if 'Jeff' not in attrs['tester'] and 'Jeff' not in attrs['leader']:
            raise serializers.ValidationError('Jeff必须是项目负责人或者在项目测试人员')
        return attrs
```

Jeff 没有在项目负责人或者在项目测试人员

![image-20210628220802148](http://becktuchuang.oss-cn-beijing.aliyuncs.com/img/image-20210628220802148.png)

## 校验顺序
```python
字段定义时的限制（包含validators列表条目从左到右进行校验）-->单字段的校验（validate_字段名）-->多字段联合校验（validate）
```

