## 快速导航

[```校验项目名不能重复```](#校验项目名不能重复)





## 校验项目名不能重复

### 修改序列化器projects/serializer.py

```python
from rest_framework import serializers
from rest_framework.validators import UniqueValidator
from projects.models import Projects


#1.继承Serializer类或者子类
class ProjectSerializer(serializers.Serializer):
    '''
    创建项目序列化器类
    '''
    #1.序列化器中定义的类属性往往与模型类字段一一对应
    #2.label选项相当于verbose_name，help_text在后台显示，是一个别名
    #3.#定义的序列化器字段，默认既可以进行序列化输出，也可以进行反序列化输入
    #4.read_only=True，指定该字段只能进行序列化输出
    #5.write_only=True,指定该字段只进行反序列化输入，但不进行序列化输出
    #6.需要输出哪些字段，那么在序列化器中就定义哪些字段。不需要输入和输出的可以直接不定义
    id = serializers.IntegerField(label='ID', read_only=True)
    name = serializers.CharField(label='项目名称', max_length=200,
                                 help_text='项目名称111', write_only=True, validators = [UniqueValidator(queryset=Projects.objects.all(), message='项目名不能重复')])
    leader = serializers.CharField(label='负责人', max_length=50, help_text='负责人')
    tester = serializers.CharField(label='测试人员', max_length=50, help_text='测试人员')
    programer = serializers.CharField(label='开发人员', max_length=50, help_text='开发人员')
    publish_app = serializers.CharField(label='发布应用', max_length=50, help_text='发布应用')
    #allow_null相当于模型类中的null，allow_blank相当于模型类中的blank
    desc = serializers.CharField(label='简要描述', allow_null=True, allow_blank=True, help_text='简要描述', default='')
```

在vscode中使用httpie发送请求：```http -v :8000/index/ < create_project.json```, 失败的提示是定义的message

![image-20210628212235267](http://becktuchuang.oss-cn-beijing.aliyuncs.com/img/image-20210628212235267.png)

### 自定义校验器is_unique_project_name

```python
#创建自定义校验器
#第一个参数为字段的值
def is_unique_project_name(name):
    #要求项目的名字必须包含项目
    if '项目' not in name:
        raise serializers.ValidationError('项目名称中必须包含"项目"')
        
        
#1.继承Serializer类或者子类
class ProjectSerializer(serializers.Serializer):
    '''
    创建项目序列化器类
    '''
    #1.序列化器中定义的类属性往往与模型类字段一一对应
    #2.label选项相当于verbose_name，help_text在后台显示，是一个别名
    #3.#定义的序列化器字段，默认既可以进行序列化输出，也可以进行反序列化输入
    #4.read_only=True，指定该字段只能进行序列化输出
    #5.write_only=True,指定该字段只进行反序列化输入，但不进行序列化输出
    #6.需要输出哪些字段，那么在序列化器中就定义哪些字段。不需要输入和输出的可以直接不定义
    id = serializers.IntegerField(label='ID', read_only=True)
    name = serializers.CharField(label='项目名称', max_length=200,
                                 help_text='项目名称111', write_only=True,
                                 validators=[UniqueValidator(queryset=Projects.objects.all(), message='项目名不能重复'), is_unique_project_name])
    leader = serializers.CharField(label='负责人', max_length=50, help_text='负责人')
    tester = serializers.CharField(label='测试人员', max_length=50, help_text='测试人员')
    programer = serializers.CharField(label='开发人员', max_length=50, help_text='开发人员')
    publish_app = serializers.CharField(label='发布应用', max_length=50, help_text='发布应用')
    #allow_null相当于模型类中的null，allow_blank相当于模型类中的blank
    desc = serializers.CharField(label='简要描述', allow_null=True, allow_blank=True, help_text='简要描述
```

