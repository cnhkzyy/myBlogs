



## 创建

如果在创建序列化器对象的时候，只给data传参，那么调用save方法，实际调用的是序列化对象的create()方法

serializer.py中的ProjectSerializer下定义

```python
    def create(self, validated_data):
        return Projects.objects.create(**validated_data)
```

在views.py中的ProjectsList的post方法中使用

```python
    def post(self, request):
        '''
        新增项目
        :param request:
        :return:
        '''
        #1.从前端获取json格式的数据，转化为Python中的类型
        #为了严谨性，这里需要做各种复杂的校验
        #比如：是否为json，传递的项目数据是否符合要求，有些必传参数是否携带等
        #反序列化
        json_data = request.body.decode('utf-8')
        python_data = json.loads(json_data, encoding='utf-8')

        #1.如果在创建序列化器对象的时候，只给data传参，那么调用save方法，实际调用的是序列化对象的create()方法
        serializer = ProjectSerializer(data=python_data)
        #校验前端输入的数据
        #1.调用序列化器对象的is_valid()方法，开始校验前端参数
        #2.如果校验成功，则返回True，校验失败返回False
        #3.raise_exception=True，那么校验失败之后，会抛出异常
        #4.当调用is_valid方法之后，才可以调用errors属性，获取校验的错误提示(字典)
        try:
            serializer.is_valid(raise_exception=True)
        except Exception as e:
            return JsonResponse(serializer.errors)
        #校验成功之后的数据，可以使用validated_data属性来获取
        #2.向数据库中新增项目
        #project = Projects.objects.create(**serializer.validated_data)
        serializer.save()

        #3.将模型类对象转化为字典返回
        #序列化
        return JsonResponse(serializer.data, status=201)
```



## 更新

在创建序列化器对象是，如果同时给instance和data传参，那么调用save()方法会自动调用序列化器对象的update()方法

serializer.py中的ProjectSerializer下定义

```python
    def update(self, instance, validated_data):
        instance.name = validated_data['name']
        instance.leader = validated_data['leader']
        instance.tester = validated_data['tester']
        instance.programer = validated_data['programer']
        instance.publish_app = validated_data['publish_app']
        instance.desc = validated_data['desc']
        instance.save()
        return instance
```

在views.py中的ProjectsDetail的put方法中使用

```python
 #全部更新，patch为部分更新
    def put(self, request, pk):
        #1.校验前端传递的pk(项目id)值，类型是否正确(正整数)，在数据中是否存在
        #2.获取指定id为pk值的项目
        project = self.get_object(pk)

        #3.从前端获取json格式的数据
        #反序列化
        json_data = request.body.decode('utf-8')
        python_data = json.loads(json_data, encoding='utf-8')
        serializer = ProjectSerializer(instance=project, data=python_data)

        try:
            serializer.is_valid(raise_exception=True)
        except Exception as e:
            return JsonResponse(serializer.errors)

        #4.更新项目
        # 在创建序列化器对象是，如果同时给instance和data传参，那么调用save()方法会自动调用序列化器对象的update()方法
        serializer.save()

        #5.将模型类对象转化为字典
        #序列化
        return JsonResponse(serializer.data, status=201)
```

